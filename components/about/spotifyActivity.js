import useSWR from 'swr';
import Image from 'next/image';

import { calcTimeAgo, fetcher } from '@/utils';

function SpotifyActivity() {
	const { data, error } = useSWR('/api/spotify', fetcher);

	if (!data || error) {
		return (
			<div className='flex space-x-4 items-center'>
				<span>
					<svg
						width='20'
						height='20'
						viewBox='0 0 20 20'
						fill='none'
						xmlns='http://www.w3.org/2000/svg'
					>
						<path
							d='M10 0C4.47719 0 0 4.47727 0 10C0 15.5231 4.47727 20 10 20C15.5232 20 20 15.5231 20 10C20 4.47766 15.5232 0.000546875 9.99984 0.000546875L9.99992 7.8125e-05L10 0ZM14.5859 14.423C14.4067 14.7167 14.0222 14.8098 13.7284 14.6295C11.3805 13.1954 8.42492 12.8705 4.94406 13.6659C4.78287 13.7025 4.61372 13.6737 4.47378 13.5857C4.33384 13.4977 4.23458 13.3577 4.19781 13.1966C4.17949 13.1168 4.17709 13.0342 4.19074 12.9534C4.20439 12.8727 4.23383 12.7955 4.27738 12.7262C4.32092 12.6568 4.3777 12.5968 4.44449 12.5494C4.51127 12.5021 4.58673 12.4684 4.66656 12.4502C8.47594 11.5799 11.7434 11.9546 14.3793 13.5655C14.673 13.7459 14.7662 14.1292 14.5859 14.423ZM15.8098 11.7001C15.5841 12.0669 15.1041 12.1827 14.7375 11.957C12.0495 10.3048 7.95211 9.82633 4.77281 10.7914C4.36047 10.9159 3.925 10.6836 3.79984 10.272C3.67563 9.85961 3.90812 9.42492 4.31977 9.29961C7.95141 8.19758 12.4663 8.73141 15.5531 10.6283C15.9197 10.8541 16.0355 11.3341 15.8098 11.7002V11.7001ZM15.9149 8.86469C12.692 6.95031 7.37453 6.77422 4.29742 7.70828C3.80328 7.85813 3.2807 7.57914 3.13102 7.085C2.98125 6.59063 3.25992 6.06844 3.75445 5.9182C7.28672 4.84586 13.1589 5.05313 16.8695 7.25594C17.3149 7.51969 17.4605 8.09375 17.1966 8.53758C16.934 8.98211 16.3584 9.12859 15.9154 8.86469H15.9149V8.86469Z'
							fill='#1ED760'
						/>
					</svg>
				</span>
				<p className='text-gray-700'>No recent activity</p>
			</div>
		);
	}

	const song = data.items[0].track.name;
	const timeAgo = calcTimeAgo(data.items[0].played_at);
	const url = `https://open.spotify.com/track/${data.items[0].track.id}`;

	return (
		<div className='flex space-x-4 items-center'>
			<span>
				<svg
					width='20'
					height='20'
					viewBox='0 0 20 20'
					fill='none'
					xmlns='http://www.w3.org/2000/svg'
				>
					<path
						d='M10 0C4.47719 0 0 4.47727 0 10C0 15.5231 4.47727 20 10 20C15.5232 20 20 15.5231 20 10C20 4.47766 15.5232 0.000546875 9.99984 0.000546875L9.99992 7.8125e-05L10 0ZM14.5859 14.423C14.4067 14.7167 14.0222 14.8098 13.7284 14.6295C11.3805 13.1954 8.42492 12.8705 4.94406 13.6659C4.78287 13.7025 4.61372 13.6737 4.47378 13.5857C4.33384 13.4977 4.23458 13.3577 4.19781 13.1966C4.17949 13.1168 4.17709 13.0342 4.19074 12.9534C4.20439 12.8727 4.23383 12.7955 4.27738 12.7262C4.32092 12.6568 4.3777 12.5968 4.44449 12.5494C4.51127 12.5021 4.58673 12.4684 4.66656 12.4502C8.47594 11.5799 11.7434 11.9546 14.3793 13.5655C14.673 13.7459 14.7662 14.1292 14.5859 14.423ZM15.8098 11.7001C15.5841 12.0669 15.1041 12.1827 14.7375 11.957C12.0495 10.3048 7.95211 9.82633 4.77281 10.7914C4.36047 10.9159 3.925 10.6836 3.79984 10.272C3.67563 9.85961 3.90812 9.42492 4.31977 9.29961C7.95141 8.19758 12.4663 8.73141 15.5531 10.6283C15.9197 10.8541 16.0355 11.3341 15.8098 11.7002V11.7001ZM15.9149 8.86469C12.692 6.95031 7.37453 6.77422 4.29742 7.70828C3.80328 7.85813 3.2807 7.57914 3.13102 7.085C2.98125 6.59063 3.25992 6.06844 3.75445 5.9182C7.28672 4.84586 13.1589 5.05313 16.8695 7.25594C17.3149 7.51969 17.4605 8.09375 17.1966 8.53758C16.934 8.98211 16.3584 9.12859 15.9154 8.86469H15.9149V8.86469Z'
						fill='#1ED760'
					/>
				</svg>
			</span>
			<p className='text-gray-700'>
				Was listening to&nbsp;
				<a
					className='lnk'
					href={url}
					target='_blank'
					rel='noopener noreferrer'
				>
					{song}
				</a>
				<span className='text-gray-500'> - {timeAgo}</span>
			</p>
		</div>
	);
}

export default SpotifyActivity;
